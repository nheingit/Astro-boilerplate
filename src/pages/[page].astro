---
import Layout from '../layouts/Layout.astro';
import '@/globals.css';
import { BlogPost } from '@/components/blog-post';
import Pagination from '../components/Pagination.astro';

export async function getStaticPaths({ paginate }) {
  const allPosts = await Astro.glob('../posts/*.md');
  
  // Sort posts by date (newest first)
  const sortedPosts = allPosts.sort((a, b) => 
    new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime()
  );

  // Generate pages, 5 posts per page
  return paginate(sortedPosts, { pageSize: 5 });
}

const { page } = Astro.props;
---

<Layout title="Nheindev">
  {page.currentPage !== 1 && (
    <Pagination currentPage={page.currentPage} totalPages={page.lastPage} baseUrl="/" />
  )}
  
  {page.data.map((post, index) => (
    <>
      <BlogPost 
        content={post.rawContent()} 
        frontmatter={{
          title: post.frontmatter.title || '',
          date: post.frontmatter.date || '',
          slug: post.frontmatter.slug || '',
          ...post.frontmatter
        }} 
      />
      {index < page.data.length - 1 && (
        <hr class="my-8 h-px border-0 bg-gray-300" />
      )}
    </>
  ))}
  
  <Pagination currentPage={page.currentPage} totalPages={page.lastPage} baseUrl="/" />
</Layout>